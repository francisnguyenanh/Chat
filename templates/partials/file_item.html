<div class="message {% if file.user_id == current_user.id %}message-right{% else %}message-left{% endif %}" 
     data-file-id="{{ file.id }}" 
     id="file-{{ file.id }}">
    <div class="message-content">
        <div class="message-author">{{ file.uploader.username }}</div>
        <div class="file-preview">
            {% if file.file_type == 'image' %}
                <img src="{{ url_for('uploaded_file', filename=file.filename) }}" 
                     alt="{{ file.original_filename }}" 
                     class="uploaded-image">
            {% else %}
                <div class="file-info">
                    <i class="bi bi-file-earmark-zip fs-1"></i>
                    <p class="mb-0">{{ file.original_filename }}</p>
                    <small class="text-muted">{{ "%.2f"|format(file.file_size / 1024 / 1024) }} MB</small>
                    <a href="{{ url_for('uploaded_file', filename=file.filename) }}" 
                       class="btn btn-sm btn-primary mt-2" 
                       download="{{ file.original_filename }}">
                        <i class="bi bi-download"></i> Tải xuống
                    </a>
                </div>
            {% endif %}
        </div>
        <div class="message-time">
            <span class="timestamp" data-utc="{{ file.upload_time.isoformat() }}">{{ file.upload_time.strftime('%H:%M') }}</span>
        </div>
        
        <!-- Delete button -->
        {% if file.user_id == current_user.id or current_user.is_admin %}
        <div class="message-actions">
            <button class="btn btn-sm btn-outline-danger" 
                    hx-delete="/api/delete_file/{{ file.id }}"
                    hx-target="#file-{{ file.id }}"
                    hx-swap="outerHTML swap:0.5s"
                    hx-confirm="Bạn có chắc muốn xóa file này?">
                <i class="bi bi-trash"></i>
            </button>
        </div>
        {% endif %}
    </div>
</div>
